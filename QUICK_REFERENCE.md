# Quick Reference: Product API with Image 128 & Quantity\n\n## What Was Added\n\nThe ProductViewSet API now returns:\n1. **Product 128px Image** - from ProductImage model's `image_1128` field\n2. **Product Quantity** - aggregated from StockQuant model\n\n## API Endpoint\n\n```\nGET /api/products/\nGET /api/products/{id}/\n```\n\n## Response Fields\n\n```json\n{\n  \"id\": 1,\n  \"vendor\": 1,\n  \"name\": { ... },\n  \"image_128\": { ... },\n  \"quantity\": 150.0\n}\n```\n\n## Quick Examples\n\n### JavaScript/Fetch\n```javascript\nconst token = 'your_jwt_token';\n\n// Get all products\nfetch('http://localhost:8000/api/products/', {\n  headers: { 'Authorization': `Bearer ${token}` }\n})\n.then(r => r.json())\n.then(data => {\n  data.results.forEach(product => {\n    console.log(`${product.name.name}: ${product.quantity} units`);\n    if(product.image_128) console.log(product.image_128.image_128);\n  });\n});\n```\n\n### Python/Requests\n```python\nimport requests\n\ntoken = 'your_jwt_token'\nheaders = {'Authorization': f'Bearer {token}'}\n\nresponse = requests.get('http://localhost:8000/api/products/', headers=headers)\nfor product in response.json()['results']:\n    print(f\"{product['name']['name']}: {product['quantity']} units\")\n    print(f\"Image: {product['image_128']}\")\n```\n\n### cURL\n```bash\ncurl -X GET \"http://localhost:8000/api/products/\" \\\n  -H \"Authorization: Bearer YOUR_TOKEN\"\n```\n\n## Response Structure\n\n### With Image and Stock\n```json\n{\n  \"id\": 1,\n  \"vendor\": 1,\n  \"name\": {\n    \"id\": 10,\n    \"name\": \"Wireless Headphones\",\n    \"price\": \"79.99\",\n    \"list_price\": \"99.99\"\n  },\n  \"image_128\": {\n    \"id\": 101,\n    \"name\": \"headphones_image\",\n    \"image_128\": \"base64_data_or_url\"\n  },\n  \"quantity\": 45.0\n}\n```\n\n### No Image Available\n```json\n{\n  \"id\": 3,\n  \"vendor\": 2,\n  \"name\": { ... },\n  \"image_128\": null,\n  \"quantity\": 25.0\n}\n```\n\n### Out of Stock\n```json\n{\n  \"id\": 5,\n  \"vendor\": 3,\n  \"name\": { ... },\n  \"image_128\": { ... },\n  \"quantity\": 0.0\n}\n```\n\n## Filters & Parameters\n\n```\n?vendor=1          # Filter by vendor ID\n?page=2            # Pagination\n?page_size=50      # Items per page\n```\n\n## Implementation Details\n\n| Component | Details |\n|-----------|----------|\n| File | `multivendor/serializers.py` |\n| Class | `ProductSerializer` |\n| Image Source | `home.models.ProductImage` (image_1128) |\n| Quantity Source | `home.models.StockQuant` (aggregated) |\n| Auth | JWT (Bearer token) |\n| Methods | `get_image_128()`, `get_quantity()` |\n\n## Field Details\n\n### image_128\n- **Type**: Object or Null\n- **Content**: Image metadata + 128px image data\n- **Fields**: id, name, image_128\n- **Default**: null (if no image found)\n\n### quantity\n- **Type**: Float\n- **Content**: Total available stock\n- **Source**: Sum of all StockQuant.quantity for product\n- **Default**: 0.0 (if no stock or error)\n\n## Error Handling\n\n- Image missing: Returns `image_128: null`\n- Quantity missing: Returns `quantity: 0.0`\n- Both are safe defaults, API won't crash\n\n## Database Queries\n\nPer product request:\n1. Product + ProductTemplate join\n2. ProductImage lookup (filtered by template)\n3. StockQuant aggregation (filtered by product)\n\n## Authentication\n\n```\nBearer Token (JWT)\n\nHeader: Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGc...\n```\n\n## Common Use Cases\n\n### Display product with image and stock\n```javascript\nfetch(`/api/products/${id}/`, { headers })\n  .then(r => r.json())\n  .then(p => {\n    document.querySelector('[data-product-name]').textContent = p.name.name;\n    document.querySelector('[data-product-price]').textContent = `$${p.name.price}`;\n    document.querySelector('[data-product-qty]').textContent = `${p.quantity} in stock`;\n    if(p.image_128) {\n      document.querySelector('[data-product-image]').src = p.image_128.image_128;\n    }\n  });\n```\n\n### Filter by vendor and check stock\n```python\nresponse = requests.get('/api/products/?vendor=1', headers=headers)\nproducts = response.json()['results']\nin_stock = [p for p in products if p['quantity'] > 0]\nprint(f\"{len(in_stock)} products in stock from vendor 1\")\n```\n\n### Get product with highest stock\n```javascript\nfetch('/api/products/', { headers })\n  .then(r => r.json())\n  .then(data => {\n    const max = data.results.reduce((a,b) => \n      a.quantity > b.quantity ? a : b\n    );\n    console.log(`Best stocked: ${max.name.name} (${max.quantity} units)`);\n  });\n```\n\n## Troubleshooting\n\n### Getting null for image_128\n- Check ProductImage table has records for this product template\n- Verify image_1128 field has data\n- Check image_1128 field is correctly named (case-sensitive)\n\n### Getting 0.0 for quantity\n- Check StockQuant table has records for this product\n- Verify quantity field has values > 0\n- Check product_id matches actual product template ID\n\n### Getting 401 Unauthorized\n- Ensure JWT token is valid\n- Check Authorization header format: `Bearer {token}`\n- Token must be obtained from login endpoint\n\n## Performance Tips\n\n1. **Caching**: Cache product data for repeat requests\n2. **Pagination**: Use page_size to limit results (default: varies)\n3. **Filtering**: Filter by vendor to reduce query load\n4. **Lazy Loading**: Load images on demand if many products\n\n## Related Files\n\n- `multivendor/serializers.py` - ProductSerializer implementation\n- `PRODUCT_API_DOCUMENTATION.md` - Full documentation\n- `PRODUCT_API_EXAMPLES.md` - Response examples\n- `IMPLEMENTATION_SUMMARY.md` - Implementation details\n\n## Support\n\nFor issues or questions:\n1. Check PRODUCT_API_DOCUMENTATION.md for detailed info\n2. Review PRODUCT_API_EXAMPLES.md for response structure\n3. Verify database tables (ProductImage, StockQuant) have data\n4. Check JWT token validity\n"