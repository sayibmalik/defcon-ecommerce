FROM odoo:18.0

USER root

# Install Python and pip
RUN apt-get update && \
    apt-get install -y python3-pip python3-venv && \
    apt-get clean

# Install Python package
RUN /usr/bin/python3 -m pip install --break-system-packages qifparse

# Set up directories and permissions
# /var/lib/odoo is where Odoo stores filestore and some configs
RUN mkdir -p /var/lib/odoo && \
    chown -R 1000:1000 /var/lib/odoo && \
    chmod -R 775 /var/lib/odoo

# Ensure /etc/odoo exists and has proper permissions for Odoo to write config
RUN mkdir -p /etc/odoo && \
    chown -R 1000:1000 /etc/odoo && \
    chmod -R 775 /etc/odoo

# Copy requirements if needed
COPY odoorequirements.txt /tmp/requirements.txt
# Optional: install other requirements
# RUN /usr/bin/python3 -m pip install -r /tmp/requirements.txt

# Copy custom addons or config if you have any
# COPY ./custom_addons /mnt/extra-addons
# COPY ./odoo.conf /etc/odoo/odoo.conf

# Switch back to Odoo user for security
USER odoo

CMD ["odoo"]
